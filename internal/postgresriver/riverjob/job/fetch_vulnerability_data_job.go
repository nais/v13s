package job

import (
	"time"

	"github.com/nais/v13s/internal/database/sql"
	"github.com/riverqueue/river"
)

const (
	KindFetchVulnerabilityDataForImages = "fetch_vulnerability_data_for_images"
)

// FetchVulnerabilityDataForImagesJob is the River job payload.
type FetchVulnerabilityDataForImagesJob struct {
	Images []*sql.Image
}

// Kind implements river.JobKind.
func (FetchVulnerabilityDataForImagesJob) Kind() string {
	return KindFetchVulnerabilityDataForImages
}

// InsertOpts controls scheduling and deduplication behavior.
func (j FetchVulnerabilityDataForImagesJob) InsertOpts() river.InsertOpts {
	return river.InsertOpts{
		Queue: KindFetchVulnerabilityDataForImages,
		UniqueOpts: river.UniqueOpts{
			ByArgs:   true,
			ByPeriod: 1 * time.Minute,
		},
		MaxAttempts: 3,
	}
}
